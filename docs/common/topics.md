---
title: 'MQTT-топики'
---

# MQTT-топики

Статья содержит обобщенные данные о структуре MQTT-топиков, посредством которых сервисы _HOMEd_ общаются друг с другом, и не включает в себя описание данных, которые содержат эти топики.

Для ознакомления со структурой данных можно почитать соответствующие статьи на страницах сервисов в этой документации или воспользоваться приложением [MQTT Explorer](http://mqtt-explorer.com) для самостоятельного изучения.

В описании топиков используются следующие шаблоны:

| Шаблон | Описание |
|--------|----------|
| `{prefix}`      | корневой топик, как указано в файле конфигурации любого сервиса |
| `{service}`     | название сервиса в нижнем регистре, например, `recorder` или `zigbee` |
| `{deviceId}`    | идентификатор устройства или его имя (в зависимости от конфигурации соответствующего сервиса) |
| `[/instance]`   | название инстанса, в случае, если оно указано в файле конфигурации (для сервисов, поддерживающих кластеризацию) |
| `[/endpointId]` | номер конечной точки для устройств с несколькими однотипными конечными точками, таких как многоканальные реле или выключатели |

## Топики сервисов

### `service`

```
{prefix}/service/{service}[/instance]
```

Топики, в которые сервисы _HOMEd_ публикуют состояние своей доступности. Данные топики являются LWT-топиками, это значит, что при потере соединения между каким-либо сервисом и MQTT-брокером (по причине плохой связи или некорректного завершения работы сервиса), брокер самостоятельно опубликует в соответствующий топик сообщение с содержимым `{"status":"offline"}`.

Топики публикуются с флагом __retain__.

### `status`

```
{prefix}/status/{service}[/instance]
```

Топики, в которые сервисы _HOMEd_ публикуют свои версии и статические данные, такие, как списки устройств, настройки дашбордов и автоматизаций.

Топики публикуются с флагом __retain__.

### `command`

```
{prefix}/command/{service}[/instance]
```

Топики, в которые сервисы _HOMEd_ публикуют сообщения для общения с другими сервисами, например, для запроса актуальных состояний или управления настройками устройств.

Топики публикуются _без_ флага __retain__.

## Топики устройств

### `device`

```
{prefix}/device/{service}[/instance]/{deviceId}
```

Топики, в которые сервисы _HOMEd_, работающие с устройствами, публикуют состояния доступности своих устройств. Помимо прочего, сервис [ZigBee](/zigbee/) публикует в эти топики метки времени `lastSeen`, указывающие на момент получения последних данных от устройства.

Топики публикуются с флагом __retain__.

### `expose`

```
{prefix}/expose/{service}[/instance]/{deviceId}
```

Топики, в которые сервисы _HOMEd_, работающие с устройствами, публикуют данные о [способностях](/common/exposes/) устройств и соответствующие им [опции](/common/options/).

Топики публикуются с флагом __retain__.

### `fd` _- from device_

```
{prefix}/fd/{service}[/instance]/{deviceId}[/endpointId]
```

Топики, в которые сервисы _HOMEd_, работающие с устройствами, публикуют данные, полученные от устройств. Помимо прочего, сервис [ZigBee](/zigbee/) публикует в эти топики параметр `linkQuality`, указывающий на качество связи с устройством (с ближайшим к координатору роутером, в случае, когда устройство работает через роутер).

Топики публикуются _без_ флага __retain__.

### `td` _- to device_

```
{prefix}/td/{service}[/instance]/{deviceId}[/endpointId]
```

Топики, из которых сервисы _HOMEd_, работающие с устройствами, получают данные для управления устройствами. Эти данные публикуются, например, сервисом [автоматизаций](/automation/).

Топики публикуются _без_ флага __retain__.

## Специальные топики

### `recorder`

```
{prefix}/recorder
```

Топик, в который [рекордер](/recorder/) публикует данные для построения графиков. Публикуется _без_ флага __retain__.
